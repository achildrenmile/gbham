{% extends "base.html" %}

{% block content %}
<section class="form-section">
    <h2>{{ t('new_entry') }}</h2>

    {% if success_message %}
    <div class="message success" role="alert">
        {{ success_message }}
    </div>
    {% endif %}

    {% if error_message %}
    <div class="message error" role="alert">
        {{ error_message }}
    </div>
    {% endif %}

    {% if is_readonly %}
    <div class="message info" role="status">
        {{ t('readonly_notice') }}
    </div>
    {% else %}
    <form action="/api/entries" method="post" class="entry-form">
        <div class="form-group">
            <label for="callsign">{{ t('callsign') }} *</label>
            <input
                type="text"
                id="callsign"
                name="callsign"
                required
                maxlength="{{ settings.MAX_CALLSIGN_LENGTH }}"
                pattern="[A-Za-z]{1,2}[0-9][A-Za-z]{1,4}(\/[A-Za-z0-9]{1,4})?"
                placeholder="z.B. OE8XBB, OE8JOTA"
                autocomplete="off"
                spellcheck="false"
            >
            <small>{{ t('callsign_hint') }}</small>
        </div>

        <div class="form-group">
            <label for="message">{{ t('message') }} *</label>
            <textarea
                id="message"
                name="message"
                required
                maxlength="{{ settings.MAX_MESSAGE_LENGTH }}"
                rows="3"
                placeholder="{{ t('message_placeholder') }}"
            ></textarea>
            <small>{{ t('message_hint', settings.MAX_MESSAGE_LENGTH) }}</small>
        </div>

        <!-- Honeypot field - hidden from users -->
        <div class="hp-field" aria-hidden="true">
            <label for="website">Website</label>
            <input type="text" id="website" name="website" tabindex="-1" autocomplete="off">
        </div>

        <button type="submit" class="btn-submit">{{ t('submit') }}</button>
    </form>

    <p class="privacy-hint">
        {{ t('privacy_hint', '<a href="/privacy?lang=' + lang + '">' + t('privacy_policy') + '</a>')|safe }}
    </p>
    {% endif %}
</section>

<section class="entries-section">
    <h2>{{ t('entries') }}{% if pagination.total_entries > 0 %} <span class="entries-count">({{ pagination.total_entries }})</span>{% endif %}</h2>

    {% if entries %}
    <ul class="entries-list">
        {% for entry in entries %}
        <li class="entry">
            <div class="entry-header">
                <strong class="callsign">{{ entry.callsign }}</strong>
                <time datetime="{{ entry.created_at.isoformat() }}">
                    {{ entry.created_at.strftime('%d.%m.%Y %H:%M') }} UTC
                </time>
            </div>
            <p class="entry-message">{{ entry.message }}</p>
        </li>
        {% endfor %}
    </ul>

    {% if pagination.total_pages > 1 %}
    <nav class="pagination" aria-label="Seitennavigation">
        <div class="pagination-info">
            {{ t('page_of', pagination.page, pagination.total_pages) }}
        </div>
        <div class="pagination-controls">
            {% if pagination.has_prev %}
            <a href="/?page=1&lang={{ lang }}" class="pagination-btn pagination-first" aria-label="{{ t('first_page') }}" title="{{ t('first_page') }}">
                <span aria-hidden="true">&laquo;</span>
            </a>
            <a href="/?page={{ pagination.prev_page }}&lang={{ lang }}" class="pagination-btn pagination-prev" aria-label="{{ t('prev_page') }}">
                <span aria-hidden="true">&lsaquo;</span> {{ t('prev_page') }}
            </a>
            {% else %}
            <span class="pagination-btn pagination-first disabled" aria-disabled="true">
                <span aria-hidden="true">&laquo;</span>
            </span>
            <span class="pagination-btn pagination-prev disabled" aria-disabled="true">
                <span aria-hidden="true">&lsaquo;</span> {{ t('prev_page') }}
            </span>
            {% endif %}

            {% if pagination.has_next %}
            <a href="/?page={{ pagination.next_page }}&lang={{ lang }}" class="pagination-btn pagination-next" aria-label="{{ t('next_page') }}">
                {{ t('next_page') }} <span aria-hidden="true">&rsaquo;</span>
            </a>
            <a href="/?page={{ pagination.total_pages }}&lang={{ lang }}" class="pagination-btn pagination-last" aria-label="{{ t('last_page') }}" title="{{ t('last_page') }}">
                <span aria-hidden="true">&raquo;</span>
            </a>
            {% else %}
            <span class="pagination-btn pagination-next disabled" aria-disabled="true">
                {{ t('next_page') }} <span aria-hidden="true">&rsaquo;</span>
            </span>
            <span class="pagination-btn pagination-last disabled" aria-disabled="true">
                <span aria-hidden="true">&raquo;</span>
            </span>
            {% endif %}
        </div>
    </nav>
    {% endif %}

    {% else %}
    <p class="no-entries">{{ t('no_entries') }}</p>
    {% endif %}
</section>
{% endblock %}
