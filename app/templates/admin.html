<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>{{ t('admin_title') }} - {{ settings.NET_NAME }}</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body class="admin-page">
    <header>
        <h1>{{ settings.NET_NAME }} - {{ t('admin_title') }}</h1>
    </header>

    <nav>
        <div class="nav-links">
            <a href="/?lang={{ lang }}">{{ t('nav_guestbook') }}</a>
        </div>
        <div class="lang-switcher">
            {% for l in languages %}
            <a href="?token={{ token }}&lang={{ l }}" class="lang-btn {% if l == lang %}active{% endif %}" title="{{ l|upper }}">
                {{ l|upper }}
            </a>
            {% endfor %}
        </div>
    </nav>

    <main>
        <section class="admin-controls">
            <h2>{{ t('admin_controls') }}</h2>

            <div class="control-panel">
                <div class="status-info">
                    <p><strong>{{ t('admin_total_entries') }}:</strong> {{ total_count }}</p>
                    <p>
                        <strong>{{ t('admin_mode') }}:</strong>
                        {% if is_readonly %}
                        <span class="status-readonly">{{ t('admin_readonly') }}</span>
                        {% else %}
                        <span class="status-active">{{ t('admin_active') }}</span>
                        {% endif %}
                    </p>
                </div>

                <div class="actions">
                    <form action="/admin/readonly/toggle?token={{ token }}" method="post" class="inline-form">
                        <button type="submit" class="btn {% if is_readonly %}btn-success{% else %}btn-warning{% endif %}">
                            {% if is_readonly %}
                            {{ t('admin_enable_write') }}
                            {% else %}
                            {{ t('admin_enable_readonly') }}
                            {% endif %}
                        </button>
                    </form>

                    <a href="/admin/export/csv?token={{ token }}" class="btn btn-secondary">
                        {{ t('admin_csv_export') }}
                    </a>

                    <a href="/?lang={{ lang }}" class="btn btn-secondary">
                        {{ t('admin_to_guestbook') }}
                    </a>
                </div>
            </div>
        </section>

        <section class="admin-entries">
            <h2>{{ t('entries') }} ({{ total_count }})</h2>

            {% if entries %}
            <table class="entries-table">
                <thead>
                    <tr>
                        <th>{{ t('admin_id') }}</th>
                        <th>{{ t('callsign') }}</th>
                        <th>{{ t('message') }}</th>
                        <th>{{ t('admin_date') }}</th>
                        <th>{{ t('admin_action') }}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in entries %}
                    <tr>
                        <td>{{ entry.id }}</td>
                        <td class="callsign">{{ entry.callsign }}</td>
                        <td class="message-cell">{{ entry.message }}</td>
                        <td>{{ entry.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td>
                            <form action="/admin/delete/{{ entry.id }}?token={{ token }}" method="post" class="inline-form"
                                  onsubmit="return confirm('{{ t('admin_delete_confirm', entry.callsign) }}');">
                                <button type="submit" class="btn btn-danger btn-small">{{ t('admin_delete') }}</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="no-entries">{{ t('admin_no_entries') }}</p>
            {% endif %}
        </section>
    </main>

    <footer>
        <p class="version">
            <a href="https://github.com/achildrenmile/gbham" target="_blank" rel="noopener noreferrer">gbHam</a>
            v{{ settings.APP_VERSION }} - {{ t('admin_title') }}
        </p>
    </footer>
</body>
</html>
